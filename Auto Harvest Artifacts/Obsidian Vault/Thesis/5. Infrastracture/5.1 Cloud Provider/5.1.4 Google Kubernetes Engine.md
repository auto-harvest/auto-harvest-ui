The production services for Auto Harvest are deployed on a **Google Kubernetes Engine (GKE)** cluster using the **Autopilot mode**, which simplifies node provisioning and integrates well with Google Cloud‚Äôs billing model. This configuration was chosen to minimize operational overhead while maintaining full Kubernetes capabilities.

#### ‚ò∏Ô∏è Cluster Configuration

Our current production cluster runs in **Autopilot mode**, configured with **three nodes** under the constraints of GCP‚Äôs **free tier**. This setup provides sufficient resources for prototyping and real-world testing while minimizing costs. Autoscaling is enabled within these limits, allowing the cluster to scale workloads up or down depending on resource demands.

#### üß© Workloads Deployed

The GKE cluster hosts several core services:

- **MongoDB** ‚Äì A self-hosted instance running with Persistent Volume Claims (PVCs) for durable storage.
    
- **ActiveMQ** ‚Äì A message broker service that acts as the communication bridge between firmware devices and the backend.
    
- **Report Server (Express API)** ‚Äì The main backend responsible for processing sensor data, serving analytics, and providing API endpoints to the frontend.
    

#### üåê Service Exposure

Services requiring external access are exposed via **LoadBalancer**-type services:

- The **API server** is publicly reachable for communication with the frontend and mobile clients.
    
- **ActiveMQ** is also exposed via a dedicated LoadBalancer to allow firmware devices to push sensor data via TCP protocols.
    

All internal services, such as MongoDB, are configured as **ClusterIP**, keeping them isolated within the Kubernetes internal network.

#### ‚öôÔ∏è Configuration Management

All Kubernetes resources are defined and managed using **Kustomize**, which allows environment-specific overlays and promotes reusable configuration files. This prevents duplication while maintaining clean separation between deployment layers.

Resource definitions include:

- **Deployments** for services
    
- **Services** (LoadBalancer and ClusterIP)
    
- **Horizontal Pod Autoscalers (HPAs)** for dynamic scaling
    
- **PersistentVolumeClaims (PVCs)** for MongoDB‚Äôs data durability
    

#### üîÅ CI/CD Integration

The deployment process is automated via **GitHub Actions**, where a custom deployment script applies Kubernetes manifests post-build. While the detailed CI/CD pipeline is described in a later section, the integration ensures that each new image pushed to Artifact Registry is automatically deployed to the cluster.

#### üîê Secrets and Environment Management

Application configuration and secrets are managed through a combination of:

- **Kubernetes ConfigMaps** ‚Äì used to import environment variables from `.env` files
    
- **Kubernetes Secrets** ‚Äì used for sensitive values (e.g., database URIs, service credentials)
    

This decouples sensitive configuration from source code and enables secure, environment-specific deployment.