The Auto Harvest deployment pipeline uses **Google Artifact Registry** as the centralized storage for Docker images used in the Kubernetes cluster. Artifact Registry enables seamless and secure integration with GitHub Actions and Google Kubernetes Engine (GKE), while supporting fine-grained access control and lifecycle management.

#### ğŸ³ Docker-Based Image Storage

We use a **regional Docker repository** within Artifact Registry, co-located with our GKE cluster to minimize latency and optimize cost. Every deployment builds and pushes a new image of the backend service to this registry. Only one container image is required per deployment, simplifying version tracking and resource usage.

#### ğŸ·ï¸ Image Tagging Strategy

Each image pushed to Artifact Registry is tagged using a **dual-tagging approach**:

- `latest` â€” used for local development and testing in the staging Kubernetes cluster.
    
- `sha-<HEAD>` â€” a unique identifier based on the commit hash at the time of the build, used for production deployments. This guarantees immutability and traceability.
    

This tagging mechanism allows flexibility in debugging while maintaining reproducibility in the production environment.

#### ğŸš€ Build and Push Workflow

Images are built automatically through GitHub Actions during each commit to the main or staging branches. The CI/CD pipeline authenticates via the previously defined `GitHub Actions Runner` service account, which includes permissions for pushing and tagging Docker images.

Once built, the image is uploaded to the Docker registry in Artifact Registry using `gcloud` CLI commands or Docker-native tooling via `gcloud auth configure-docker`.

#### ğŸ§¹ Lifecycle and Retention

To keep storage costs predictable and the registry clean, a **manual pruning policy** is implemented where only the **10 most recent images** are retained. This is enforced via cleanup scripts triggered periodically, or during deployment.

#### ğŸ” Access Control

Only the CI/CD pipeline (via service account) and system administrators (via impersonation) have write access to Artifact Registry. All other access is read-only or restricted based on IAM policy, maintaining a secure image supply chain.