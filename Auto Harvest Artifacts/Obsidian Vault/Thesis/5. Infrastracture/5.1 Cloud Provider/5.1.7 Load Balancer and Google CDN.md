The Auto Harvest infrastructure integrates a **Google Cloud HTTPS Load Balancer** to manage ingress traffic to both API services and static frontend assets. This layer acts as the critical bridge between **Cloudflare’s global edge network** and the internal workloads running in the GKE cluster or served via Cloud Storage buckets.

#### 🌐 External HTTPS Load Balancer

Due to provisioning issues with Kubernetes-native Ingress resources, we opted to manually configure an **external HTTPS Load Balancer** through the GCP console. This approach allowed us to reliably provision **static IP addresses**, a feature that often failed under the automatic Ingress workflow.

Each backend service (e.g., API or Cloud Storage bucket) is attached to the load balancer via backend service bindings, exposing services securely and consistently.

#### 🧊 Google Cloud CDN

Google’s internal **Cloud CDN** is enabled on the load balancer’s backend services — particularly for:

- **Static file hosting buckets**
    
- (Future) scalable microservices or API endpoints that are cache-friendly
    

This CDN layer provides caching at Google’s edge locations after Cloudflare forwards requests, reducing latency for repeated file access.

#### 🩺 Health Checks

Each backend is configured with a **default HTTP health check** that monitors availability via a simple request to port `:80`. Since Auto Harvest uses a stateless RESTful API model, no session affinity is required — each request is handled independently by any available pod or service instance.

#### 📁 Backend Buckets and Caching Strategy

Buckets used for frontend deployments are attached to the load balancer using **backend buckets**, allowing Google’s CDN layer to serve static content. Caching behavior is controlled at both the Cloudflare and GCP levels.

We implement a custom invalidation strategy:

- **Full cache invalidation** is triggered through GCP’s UI when necessary.
    
- **On-demand bypass** is available via a special request header: `no-cache-baby`.
    
    - This header, recognized by both Cloudflare and GCP, instructs edge nodes to **bypass cache** for rapid frontend testing or debugging.
        

A button in Cloudflare’s header rewrite rules allows collaborators to toggle this behavior in real time, solving the problem of **slow CDN invalidation (up to 10 minutes)** during rapid development cycles.

#### 🔐 SSL Configuration

Traffic is only accepted by GCP from **Cloudflare-signed SSL certificates**, ensuring that no direct requests bypass Cloudflare’s firewall and filtering. This provides full end-to-end encryption and validates traffic origin through Cloudflare’s infrastructure.